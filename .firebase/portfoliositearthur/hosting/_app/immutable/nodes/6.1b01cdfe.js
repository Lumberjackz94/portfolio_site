import{s as se,v as Z,r as G,e as H,g as w,c as U,h as T,i as B,d as V,A as D,k as A,C as J,D as oe,E as ae,l as k,m as y,z as le}from"../chunks/scheduler.283841f9.js";import{S as ue,i as ce,d as R,v as fe,j as re,k as me,m as de,b as he,t as _e,l as pe,a as P,e as b,g as v,n as _,p as I,s as O}from"../chunks/index.c9f7c5ae.js";import{A as x}from"../chunks/AuthCheck.6de8cd6b.js";import{e as j,u as L,c as W,g as N,j as K,W as Q}from"../chunks/firebase.2a115845.js";const be=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,{console:ge}=be,C="src/routes/login/username/+page.svelte";function $(i){let e,t,l,n,a,s,o,f,g,u=i[1]&&z(i),m=!i[3]&&i[5]&&Y(i),d=i[3]&&!i[2]&&!i[1]&&q(i),h=i[2]&&F(i);const E={c:function(){e=w("form"),t=w("input"),l=U(),n=w("div"),u&&u.c(),a=U(),m&&m.c(),s=U(),d&&d.c(),o=U(),h&&h.c(),this.h()},l:function(r){e=T(r,"FORM",{class:!0});var p=B(e);t=T(p,"INPUT",{type:!0,placeholder:!0,class:!0}),l=V(p),n=T(p,"DIV",{class:!0});var c=B(n);u&&u.l(c),a=V(c),m&&m.l(c),s=V(c),d&&d.l(c),o=V(c),h&&h.l(c),c.forEach(b),p.forEach(b),this.h()},h:function(){v(t,"type","text"),v(t,"placeholder","Username"),v(t,"class","input w-full"),D(t,"input-error",!i[3]&&i[5]),D(t,"input-warning",i[4]),D(t,"input-success",i[2]&&i[3]&&!i[1]),A(t,C,69,8,1667),v(n,"class","my-4 min-h-16 px-8 w-full"),A(n,C,79,8,2011),v(e,"class","w-2/5"),A(e,C,68,6,1595)},m:function(r,p){P(r,e,p),_(e,t),J(t,i[0]),_(e,l),_(e,n),u&&u.m(n,null),_(n,a),m&&m.m(n,null),_(n,s),d&&d.m(n,null),_(n,o),h&&h.m(n,null),f||(g=[I(t,"input",i[9]),I(t,"input",i[7],!1,!1,!1,!1),I(e,"submit",oe(i[8]),!1,!0,!1,!1)],f=!0)},p:function(r,p){p&1&&t.value!==r[0]&&J(t,r[0]),p&40&&D(t,"input-error",!r[3]&&r[5]),p&16&&D(t,"input-warning",r[4]),p&14&&D(t,"input-success",r[2]&&r[3]&&!r[1]),r[1]?u?u.p(r,p):(u=z(r),u.c(),u.m(n,a)):u&&(u.d(1),u=null),!r[3]&&r[5]?m||(m=Y(r),m.c(),m.m(n,s)):m&&(m.d(1),m=null),r[3]&&!r[2]&&!r[1]?d?d.p(r,p):(d=q(r),d.c(),d.m(n,o)):d&&(d.d(1),d=null),r[2]?h?h.p(r,p):(h=F(r),h.c(),h.m(n,null)):h&&(h.d(1),h=null)},d:function(r){r&&b(e),u&&u.d(),m&&m.d(),d&&d.d(),h&&h.d(),f=!1,ae(g)}};return R("SvelteRegisterBlock",{block:E,id:$.name,type:"else",source:"(55:4) {:else}",ctx:i}),E}function ee(i){let e,t,l,n,a=i[6].username+"",s;const o={c:function(){e=w("p"),t=k("Your username is "),l=w("span"),n=k("@"),s=k(a),this.h()},l:function(g){e=T(g,"P",{});var u=B(e);t=y(u,"Your username is "),l=T(u,"SPAN",{});var m=B(l);n=y(m,"@"),s=y(m,a),m.forEach(b),u.forEach(b),this.h()},h:function(){A(l,C,65,25,1531),A(e,C,64,6,1502)},m:function(g,u){P(g,e,u),_(e,t),_(e,l),_(l,n),_(l,s)},p:function(g,u){u&64&&a!==(a=g[6].username+"")&&O(s,a)},d:function(g){g&&b(e)}};return R("SvelteRegisterBlock",{block:o,id:ee.name,type:"if",source:"(51:4) {#if $userData != null && $userData.username}",ctx:i}),o}function z(i){let e,t,l,n;const a={c:function(){e=w("p"),t=k("Checking availability of @"),l=k(i[0]),n=k("..."),this.h()},l:function(o){e=T(o,"P",{class:!0});var f=B(e);t=y(f,"Checking availability of @"),l=y(f,i[0]),n=y(f,"..."),f.forEach(b),this.h()},h:function(){v(e,"class","text-secondary"),A(e,C,81,12,2087)},m:function(o,f){P(o,e,f),_(e,t),_(e,l),_(e,n)},p:function(o,f){f&1&&O(l,o[0])},d:function(o){o&&b(e)}};return R("SvelteRegisterBlock",{block:a,id:z.name,type:"if",source:"(68:10) {#if loading}",ctx:i}),a}function Y(i){let e,t="must be 3-16 characters long, alphanumeric only";const l={c:function(){e=w("p"),e.textContent=t,this.h()},l:function(a){e=T(a,"P",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-1suomdh"&&(e.textContent=t),this.h()},h:function(){v(e,"class","text-error text-sm"),A(e,C,85,12,2230)},m:function(a,s){P(a,e,s)},d:function(a){a&&b(e)}};return R("SvelteRegisterBlock",{block:l,id:Y.name,type:"if",source:"(72:10) {#if !isValid && isTouched}",ctx:i}),l}function q(i){let e,t,l,n;const a={c:function(){e=w("p"),t=k("@"),l=k(i[0]),n=k(" is not available"),this.h()},l:function(o){e=T(o,"P",{class:!0});var f=B(e);t=y(f,"@"),l=y(f,i[0]),n=y(f," is not available"),f.forEach(b),this.h()},h:function(){v(e,"class","text-warning text-sm"),A(e,C,91,12,2427)},m:function(o,f){P(o,e,f),_(e,t),_(e,l),_(e,n)},p:function(o,f){f&1&&O(l,o[0])},d:function(o){o&&b(e)}};return R("SvelteRegisterBlock",{block:a,id:q.name,type:"if",source:"(78:10) {#if isValid && !isAvailable && !loading}",ctx:i}),a}function F(i){let e,t,l;const n={c:function(){e=w("button"),t=k("Confirm username @"),l=k(i[0]),this.h()},l:function(s){e=T(s,"BUTTON",{class:!0});var o=B(e);t=y(o,"Confirm username @"),l=y(o,i[0]),o.forEach(b),this.h()},h:function(){v(e,"class","btn btn-success"),A(e,C,97,12,2583)},m:function(s,o){P(s,e,o),_(e,t),_(e,l)},p:function(s,o){o&1&&O(l,s[0])},d:function(s){s&&b(e)}};return R("SvelteRegisterBlock",{block:n,id:F.name,type:"if",source:"(84:10) {#if isAvailable}",ctx:i}),n}function te(i){let e;function t(s,o){return s[6]!=null&&s[6].username?ee:$}let l=t(i),n=l(i);const a={c:function(){n.c(),e=H()},l:function(o){n.l(o),e=H()},m:function(o,f){n.m(o,f),P(o,e,f)},p:function(o,f){l===(l=t(o))&&n?n.p(o,f):(n.d(1),n=l(o),n&&(n.c(),n.m(e.parentNode,e)))},d:function(o){o&&b(e),n.d(o)}};return R("SvelteRegisterBlock",{block:a,id:te.name,type:"slot",source:"(50:2) <AuthCheck>",ctx:i}),a}function M(i){let e,t;e=new x({props:{$$slots:{default:[te]},$$scope:{ctx:i}},$$inline:!0});const l={c:function(){re(e.$$.fragment)},l:function(a){me(e.$$.fragment,a)},m:function(a,s){de(e,a,s),t=!0},p:function(a,[s]){const o={};s&4223&&(o.$$scope={dirty:s,ctx:a}),e.$set(o)},i:function(a){t||(he(e.$$.fragment,a),t=!0)},o:function(a){_e(e.$$.fragment,a),t=!1},d:function(a){pe(e,a)}};return R("SvelteRegisterBlock",{block:l,id:M.name,type:"component",source:"",ctx:i}),l}const X=/^(?=[a-zA-Z0-9._]{3,16}$)(?!.*[_.]{2})[^_.].*[^_.]$/;function ke(i,e,t){let l,n,a,s,o;Z(L,"user"),G(i,L,c=>t(11,s=c)),Z(W,"userData"),G(i,W,c=>t(6,o=c));let{$$slots:f={},$$scope:g}=e;fe("Page",f,[]);let u="",m=!1,d=!1,h;async function E(){t(2,d=!1),clearTimeout(h),t(1,m=!0),h=setTimeout(async()=>{console.log("checking availability of",u);const c=N(j,"usernames",u),ne=await K(c).then(ie=>ie.exists());t(2,d=!ne),t(1,m=!1)},500)}async function S(){console.log("confirming username",u);const c=Q(j);c.set(N(j,"usernames",u),{uid:s==null?void 0:s.uid}),c.set(N(j,"users",s.uid),{username:u,photoURL:(s==null?void 0:s.photoURL)??null,published:!0,bio:"I am the Walrus",links:[{title:"Test Link",url:"https://kung.foo",icon:"custom"}]}),await c.commit(),t(0,u=""),t(2,d=!1)}const r=[];Object.keys(e).forEach(c=>{!~r.indexOf(c)&&c.slice(0,2)!=="$$"&&c!=="slot"&&ge.warn(`<Page> was created with unknown prop '${c}'`)});function p(){u=this.value,t(0,u)}return i.$capture_state=()=>({AuthCheck:x,db:j,user:L,userData:W,doc:N,getDoc:K,writeBatch:Q,username:u,loading:m,isAvailable:d,debounceTimer:h,re:X,checkAvailability:E,confirmUsername:S,isValid:l,isTaken:a,isTouched:n,$user:s,$userData:o}),i.$inject_state=c=>{"username"in c&&t(0,u=c.username),"loading"in c&&t(1,m=c.loading),"isAvailable"in c&&t(2,d=c.isAvailable),"debounceTimer"in c&&(h=c.debounceTimer),"isValid"in c&&t(3,l=c.isValid),"isTaken"in c&&t(4,a=c.isTaken),"isTouched"in c&&t(5,n=c.isTouched)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),i.$$.update=()=>{i.$$.dirty&1&&t(3,l=(u==null?void 0:u.length)>2&&u.length<16&&X.test(u)),i.$$.dirty&1&&t(5,n=u.length>0),i.$$.dirty&14&&t(4,a=l&&!d&&!m)},[u,m,d,l,a,n,o,E,S,p]}class Ae extends ue{constructor(e){super(e),ce(this,e,ke,M,se,{}),R("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:M.name})}}export{Ae as component};
